<!--
title: qoqcot
description: 
published: true
date: 2026-02-05T09:26:33.675Z
tags: 
editor: ckeditor
dateCreated: 2025-12-11T13:53:05.500Z
-->

<p>Installation de PHP7.4 sur Debian 12 &nbsp;</p>
<pre><code class="language-plaintext">apt install -y apt-transport-https lsb-release ca-certificates wget &amp;&amp; wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg &amp;&amp; echo "deb https://packages.sury.org/php/ $(lsb_release -sc) main" | tee /etc/apt/sources.list.d/php.list &amp;&amp; apt update &amp;&amp; apt install php7.4-common php7.4-cli php7.4-mysql php7.4-gd php7.4-ldap php7.4-mbstring php7.4-mcrypt php7.4-xml libapache2-mod-php7.4  </code></pre>
<p>Installation des autres dépendance + PERL</p>
<pre><code class="language-plaintext">apt install apache2 mariadb-server libyaml-tiny-perl libdbd-mysql-perl</code></pre>
<p>Configuration de la date dans PHP</p>
<pre><code class="language-plaintext">nano /etc/php/7.4/apache2/php.ini



#Remplacer ;date.timezone =  par date.timezone = "Europe/Paris"</code></pre>
<p>Télécharger et extraire QoQ-CoT</p>
<pre><code class="language-plaintext">wget https://sourcesup.renater.fr/frs/download.php/file/6336/QoQ-CoT_v5.0_Mac_Bec.tgz &amp;&amp; tar xvf QoQ-CoT_v5.0_Mac_Bec.tgz &amp;&amp; cp -r /root/qoq-cot/src/* /var/www/html/</code></pre>
<p>Configuration du site &nbsp;</p>
<pre><code class="language-plaintext">rm /var/www/html/index.html
cp /var/www/html/config.php.dist /var/www/html/config.php
nano /var/www/html/config.php
#Configurer le fichier

&lt;?php
//Définition des constantes relatives à la base de données : ces informations doivent être identiques
//à celles du fichier coq.yml, où la base Qoq-CoT et son user associée doivent aussi être fournies
define('SQL_DBNAME', 'QoqCoT');
define('SQL_HOST', 'localhost');
define('SQL_PORT', '3306');
define('SQL_USERNAME', 'XXXXXXXXXXX');
define('SQL_PASSWORD', 'XXXXXXXXXXX');

//Jours ouvrés par défaut
//Jours ouvrés dans la semaine (0 = dimanche, 1 = lundi, ..., 6 = samedi)
define('JOURS_OUVRES', serialize(array(1, 2, 3, 4, 5)));

//Fenêtre d'observation quotidienne par défaut
define('HEURE_DEBUT', '08:00');
define('HEURE_FIN', '18:00');

//Définition de l'url des pages annuaire
//Remplacer le nom d'usager par la chaine login _LOGIN_ dans l'URL standard d'accès à la page annuaire d'un usager
//Exemple : http://annuaire.chezvous.fr/showuser.php?uid=_LOGIN_
define('URL_ANNUAIRE', '&lt;URL_PAGE_ANNUAIRE_DE_UTILISATEUR_LOGIN_&gt;');

//Le premier Admin
//A l'installation, l'usager décrit ci-dessous bénéficiera du rôle admin (et pourra créer les suivants depuis l'interface)
define('FIRST_ADMIN', 'ADMIN');

//Sites
//Déclarer les sites à l'intérieur du tableau. Ex : array('Site1','Site2','Site3')
//Si un seul site, commenter la ligne qui suit ou laisser vide le tableau : array()
define('SITES', serialize(array()));

//Pour accélérer le calcul de graphe, il est possible d'utiliser une table contenant seulement
//les connexions remontant au nombre de jours indiqué dans la variable CONNEXIONS_CACHE
//Si CONNEXIONS_CACHE est instancié à 0 alors cette table ne sera pas mise en place
//A chaque fois que la valeur CONNEXIONS_CACHE sera modifiée, il sera nécessaire de relancer
//la commande php setup.php -C afin de mettre la table à jour
define('CONNEXIONS_CACHE', 0);





cp /root/qoq-cot/ressources/EXEMPLES_.htaccess/.htaccess_super_basic_web_1.0_example /var/www/html/.htaccess
nano /var/www/html/.htaccess
########################
# Dans ce cas, seuls les usagers "locaux" définis dans le fichier htpasswd auront accès à la QoQ-CoT après authentification basique Apache
AuthName "Accès poulette strictement règlementé"
AuthType Basic
AuthUserFile "/etc/apache2/QoQCoT/.htpasswd"
Require valid-user
########################

mkdir /etc/apache2/QoQCoT
htpasswd /etc/apache2/QoQCoT/.htpasswd ADMIN

nano /etc/apache2/sites-enabled/000-default.conf
########################
&lt;VirtualHost *:80&gt;
    # The ServerName directive sets the request scheme, hostname and port that
    # the server uses to identify itself. This is used when creating
    # redirection URLs. In the context of virtual hosts, the ServerName
    # specifies what hostname must appear in the request's Host: header to
    # match this virtual host. For the default virtual host (this file) this
    # value is not decisive as it is used as a last resort host regardless.
    # However, you must set it for any further virtual host explicitly.
    #ServerName www.example.com

    &lt;Directory /var/www/html&gt;
        AllowOverride AuthConfig
    &lt;/Directory&gt;

    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,
    # error, crit, alert, emerg.
    # It is also possible to configure the loglevel for particular
    # modules, e.g.
    #LogLevel info ssl:warn

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    # For most configuration files from conf-available/, which are
    # enabled or disabled at a global level, it is possible to
    # include a line for only one particular virtual host. For example the
    # following line enables the CGI configuration for this host only
    # after it has been globally disabled with "a2disconf".
    #Include conf-available/serve-cgi-bin.conf
&lt;/VirtualHost&gt;                                                                                                  &lt;/VirtualHost&gt;
########################</code></pre>
<p>Sécurisation du server SQL &nbsp;</p>
<pre><code class="language-plaintext">mariadb-secure-installation
mysql -u root -p mysql
	alter user 'root'@'localhost' identified by 'PASSWORD ROOT SQL';
	exit</code></pre>
<p>Export ancienne base SQL + Nettoyage&nbsp;</p>
<pre><code class="language-plaintext">mysql -u root -p mysql
USE QoQCoT ;

# Je supprime les anciennes bases. Mais je garde l'historique des logs.
DROP TABLE Admins ;
DROP TABLE MachinesToSalles ;
DROP TABLE Salles ;
DELETE FROM Connexions WHERE Connexions.DateDebut &lt; '2019-12-01' ;


# Copie de la base sur le nouveau serveur.
mysqldump -u root -p QoQCoT &gt; /root/QoQCoT.sql
scp /root/QoQCoT.sql root@X.X.X.X:/root/QoQCoT.sql


mysql -u root -p mysql
CREATE DATABASE QoQCoT;
exit;
mysql -u root -p QoQCoT &lt; /root/QoQCoT.sql</code></pre>
<p>Maj de la version 4 à 5 de QoQCoT</p>
<pre><code class="language-plaintext">ALTER TABLE Connexions CHANGE NomMachine NomMachine VARCHAR(64) CHARACTER SET utf8 COLLATE utf8_unicode_ci NOT NULL,CHANGE NomOs NomOs VARCHAR(32) CHARACTER SET utf8 COLLATE utf8_unicode_ci NOT NULL,ADD IPMachine VARCHAR(15) NULL AFTER NomMachine,ADD NomVM VARCHAR(64) NULL AFTER JourSemaine, ADD IPVM VARCHAR(15) NULL AFTER NomVM,DROP IdProcess,ADD INDEX(NomMachine);</code></pre>
<p>Configuration de la base SQL &nbsp;</p>
<pre><code class="language-plaintext">cp /root/qoq-cot/ressources/INSTALL/CREATE_DB_AND_USER_QoQ-CoT.sh /var/www/html/
cd /var/www/html/
./CREATE_DB_AND_USER_QoQ-CoT.sh
#Répondre aux questions</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">mkdir /usr/local/coq
cp /root/qoq-cot/ressources/poussin-coq/coq/SOURCES/coq.pl  /usr/local/coq/
cp /root/qoq-cot/ressources/poussin-coq/coq/conf/coq.yml  /usr/local/coq/
cp /root/qoq-cot/ressources/poussin-coq/coq/coqd  /etc/default/
cp /root/qoq-cot/ressources/poussin-coq/coq/coqd.sh  /etc/init.d/
nano /usr/local/coq/coq.yml
 
#########################

---

tea_keys :

# k1, k2, k3 et k4 sont utilisés pour construire la clé de chiffrement 128 bits pour les communications entre le poussin et le coq, ils doivent donc être identiques dans poussin.yml et coq.yml. Pas d'autres contraintes entre k1, k2 k3 et k4 qui peuvent être tous différents, ou non...

       k1 : 128

       k2 : 256

       k3 : 512

       k4 : 1024

server :

port : 6222

db :

# Les informations suivantes doivent être identiques à celles du fichier config.php,  

# où la base QoQ-CoT et son user associée doivent aussi être fournies

 SQL_DBNAME : QoQCoT

 SQL_HOST : localhost

 SQL_PORT : 3306

 SQL_USERNAME : QoQCoT_user

 SQL_PASSWORD : XXXXXXXXXXX

exclude : ^(DWM|UMFD)

#########################</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">nano /etc/default/coqd
#Remplacer COQPATH=/usr/local/coq/coq64 par COQPATH=/usr/local/coq/coq.pl</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">useradd coq
update-rc.d coqd.sh defaults</code></pre>
<p><br>##Intégration des postes en création des première tables &nbsp;</p>
<pre><code class="language-plaintext">nano /var/www/html/pc.csv
#Insertion de postes sous la forme PC,salle,Groupe,Date-Debut,Date-Fin
cd /var/www/html/
php setup.php pc.csv  </code></pre>
